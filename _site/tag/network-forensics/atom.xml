<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
   	<title>RealJenius.com - Tag: network forensics</title>
   
   <link>http://realjenius.com</link>
   <description>I'm a software developer in the game industry, and have been (for better or worse) coding on the Java platform for the last decade. I also do all my own stunts.</description>
   <language>en-us</language>
   <managingEditor>R.J. Lorimer</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
  <title>CodeGate 2010 &#8211; Challenge 6 writeup</title>
  <link>http://realjenius.com/ctf%20-%20clgt%20crew/2010/03/20/codegate-2010-challenge-6-writeup.html</link>
  <author>R.J. Lorimer</author>
  <pubDate>2010-03-20T00:00:00+08:00</pubDate>
  <guid>http://realjenius.com/ctf%20-%20clgt%20crew/2010/03/20/codegate-2010-challenge-6-writeup.html</guid>
  <description><![CDATA[
     <h1 id="summary">Summary</h1>

<p>Challenge 6 is a forensics problem with a mountain of data, a packet capture file and a FAT32 filesystem image. In order to find the secret you have to watch for the “key” exchanged via MSN conversation in a packet capture file, then use it to find the secret file name. With forensics problems, luck is more important than techniques and you should only do it if you don’t have anything to play during the game.</p>

<h1 id="analysis">Analysis</h1>

<p>Challenge information:</p>

<blockquote>
  <p>credentials:</p>

  <p>http://ctf.codegate.org/thisiswhereiuploadmyfiles/CC2A8B4FA2E1FA6BD7FE9B8EFC86BCB7</p>

  <p>Substitute for those who are not in Korea : http://www.mediafire.com/?wyhexdmzzdm</p>

  <p>You should convert the flag into lower case letters and try to auth with it.</p>

  <p>Hint: The packet of messenger is important. You don’t need to care the ftp stuff.</p>

  <p>Hint2: Please put your flag without any extension to the auth page.</p>
</blockquote>

<h2 id="file-info">File info</h2>

<blockquote>
  <pre>$ file CC2A8B4FA2E1FA6BD7FE9B8EFC86BCB7
CC2A8B4FA2E1FA6BD7FE9B8EFC86BCB7: gzip compressed data, from Unix, last modified: Fri Mar 12 17:20:19 2010
</pre>
</blockquote>

<p>$ zcat CC2A8B4FA2E1FA6BD7FE9B8EFC86BCB7 &gt; challenge6
$ file challenge6
challenge6: POSIX tar archive (GNU)</p>

<p>$ tar xvf challenge6
352FCD8BDEC8244CDED00CA866CA24B9
B400CBEA39EA52126E2478E9A951CDE8</p>

<p>$ file 352FCD8BDEC8244CDED00CA866CA24B9 B400CBEA39EA52126E2478E9A951CDE8
352FCD8BDEC8244CDED00CA866CA24B9: tcpdump capture file (little-endian) - version 2.4 (Ethernet, capture length 65535)
B400CBEA39EA52126E2478E9A951CDE8: x86 boot sector, code offset 0x58, OEM-ID “MSDOS5.0”,
sectors/cluster 8, reserved sectors 4334, Media descriptor 0xf8, heads 255, sectors 1982464 (volumes &gt; 32 MB) ,
FAT (32 bit), sectors/FAT 1929, reserved3 0x800000, serial number 0x7886931a, unlabeled&lt;/pre&gt;</p>

<p>We have 2 files: a tcpdump packet capture and a FAT32 filesystem image. From the hints (yes, without it we don’t know what to search for), we focus our search to:</p>

<ul>
  <li>Final secret key must be a file and it may rely on FAT32 image</li>
  <li>Keyword to find out that secret file must be exchanged via MSN conversation(s) in tcpdump file</li>
</ul>

<h2 id="msn-conversation">MSN conversation</h2>

<p>Using chaosreader (you can use other tools to have the same result) to analyse pcap file, we will have a list of sessions like below:</p>

<p><img class="alignnone size-full wp-image-733" title="Chaosreader Report - msnp" src="http://vnsecurity.net/wp/storage/uploads/2010/03/Chaosreader-Report-352FCD8BDEC8244CDED00CA866CA24B9.pcap_1269063206104.png" alt="Chaosreader Report - msnp" width="953" height="173" /></p>

<p>The session number 263 &amp; 264 is MSN chat. Following the conversion by looking in to raw file we find some interesting things:</p>

<blockquote>
  <p><span style="color: #0000ff">forensic-proof@live.com&gt; i;d like to get a file that i asked you before……<br /> forensic-proof@live.com&gt; now availabel?</span></p>

  <p><span style="color: #ff0000">securityholic@hotmail.com&gt; ah<br /> securityholic@hotmail.com&gt; ok wait a min <img src="http://vnsec-new.cloudapp.net/wp/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /><br /> </span><br />
[… MSN P2P file transfer session …]</p>

  <p><span style="color: #0000ff">forensic-proof@live.com&gt; thanks….<br /> </span><br />
<span style="color: #ff0000">securityholic@hotmail.com&gt; this is between you and me :-/</span></p>
</blockquote>

<p>It looks like they exchange some “secret” via MSN P2P file transfer. Looking at file transfer session (refer to References for MSN protocol) :</p>

<blockquote>
  <p>To: &lt;msnmsgr:securityholic@hotmail.com;{95178158-37b6-45ce-b332-2042a4d27563}&gt;<br />
From: &lt;msnmsgr:forensic-proof@live.com;{281f2818-580b-46f0-909f-c009de526642}&gt;<br />
Via: MSNSLP/1.0/TLP ;branch={51D93360-BFBD-40CB-AD0A-2D7FB5C28031}<br />
CSeq: 1<br />
Call-ID: {71021C00-FE1C-4E91-B415-D2145D7C1C24}<br />
Max-Forwards: 0<br />
Content-Type: application/x-msnmsgr-transrespbody<br />
Content-Length: 482</p>

  <p>Listening: true<br />
NeedConnectingEndpointInfo: false<br />
Conn-Type: Direct-Connect<br />
TCP-Conn-Type: Direct-Connect<br />
IPv6-global: 2001:0:cf2e:3096:2036:1131:5c67:c1c5<br />
UPnPNat: false<br />
Capabilities-Flags: 1<br />
<strong>srddA-lanretnI4vPI: 85.26.251.361<br />
troP-lanretnI4vPI: 2133</strong><br />
IPv6-Addrs: 2001:0:cf2e:3096:2036:1131:5c67:c1c5 2002:a398:3e3a::a398:3e3a<br />
IPv6-Port: 3313<br />
Nat-Trav-Msg-Type: WLX-Nat-Trav-Msg-Direct-Connect-Resp<br />
Bridge: TCPv1<br />
Hashed-Nonce: {E3759BB3-EED9-04F3-3B1A-56044619D59F}</p>
</blockquote>

<p>What the hell is this: **srddA-lanretnI4vPI: 85.26.251.361? **It’s reversed! So, file transfer session has this information: **IPv4Internal-Addrs: 163.152.62.58, IPv4Internal-Port: 3312. **It’s confirmed by looking at chaosreader output:</p>

<p><img class="alignnone size-full wp-image-734" title="Chaosreader Report- 3312" src="http://vnsecurity.net/wp/storage/uploads/2010/03/Chaosreader-Report-352FCD8BDEC8244CDED00CA866CA24B9.pcap_1269063302409.png" alt="Chaosreader Report- 3312" width="914" height="21" /></p>

<p>Let dump that session and use tcpxtract to extract files from the pcap:</p>

<blockquote>
  <pre>$ tcpdump -nn -r 352FCD8BDEC8244CDED00CA866CA24B9 'port 3312' -w 3312.pcap</pre>

  <pre>$ tcpxtract -f 3312.pcap
 Found file of type "pdf" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000001.pdf
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000008.jpg
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000009.jpg
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000010.jpg
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000011.jpg
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000012.jpg
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000013.jpg
 Found file of type "jpg" in session [163.152.62.59:37390 -&gt; 163.152.62.58:61452], exporting to 00000014.jpg</pre>
</blockquote>

<p>During the game, we opened PDF file but it’s just blank then we focused on JPG files, but no luck. Re-examined the blank PDF, by “Select All” we found there’s hidden text at the bottom of  the page: **CC105EE2A139A631175571452968D637. **Looks like a “key” – checksum of the secret file.</p>

<p>Searching on FA32 filesystem image for that checksum:</p>

<blockquote>
  <pre>$ sudo mount -o loop,ro B400CBEA39EA52126E2478E9A951CDE8 /mnt/loop
</pre>
</blockquote>

<p>$ find /mnt/loop -type f -exec md5sum {} ; &gt;&gt; md5sum.txt</p>

<p>$ grep -i CC105EE2A139A631175571452968D637 md5sum.txt
cc105ee2a139a631175571452968d637  /mnt/loop/hqksksk/iologmsg.dat&lt;/pre&gt;</p>

<p>Matched! Finally, the secret key is: **iologmsg. **We’re just lucky!</p>

<p>Now, look back to the hint “You should convert the flag into lower case letters and try to auth with it.”, it sounds irrelevant or the md5sum was the correct key at first?</p>

<h1 id="references">References</h1>

<ul>
  <li><a href="http://msnpiki.msnfanatic.com/index.php/MSNC:MSNSLP" target="_blank">http://msnpiki.msnfanatic.com/index.php/MSNC:MSNSLP</a></li>
  <li><a href="http://www.hypothetic.org/docs/msn/client/file_transfer.php" target="_blank">http://www.hypothetic.org/docs/msn/client/file_transfer.php</a></li>
  <li><a href="http://chaosreader.sourceforge.net/" target="_blank">http://chaosreader.sourceforge.net/</a></li>
  <li><a href="http://tcpxtract.sourceforge.net/" target="_blank">http://tcpxtract.sourceforge.net/</a></li>
</ul>

<p>Keywords: network forensics, msn protocol, codegate 2010</p>

  ]]></description>
</item>

</channel>
</rss>