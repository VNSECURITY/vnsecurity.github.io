<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
   	<title>RealJenius.com - Tag: padding</title>
   
   <link>http://realjenius.com</link>
   <description>I'm a software developer in the game industry, and have been (for better or worse) coding on the Java platform for the last decade. I also do all my own stunts.</description>
   <language>en-us</language>
   <managingEditor>R.J. Lorimer</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
  <title>CodeGate 2010 Challenge 15 &#8211; SHA1 padding attack</title>
  <link>http://realjenius.com/ctf%20-%20clgt%20crew/2010/03/16/codegate_challenge15_sha1_padding_attack.html</link>
  <author>R.J. Lorimer</author>
  <pubDate>2010-03-16T00:00:00+08:00</pubDate>
  <guid>http://realjenius.com/ctf%20-%20clgt%20crew/2010/03/16/codegate_challenge15_sha1_padding_attack.html</guid>
  <description><![CDATA[
     <h2 id="summary">Summary</h2>

<p>This is a web based crypto challenge vulnerable to padding/length extension attack in its sha1 based authentication scheme.</p>

<h2 id="analysis">Analysis</h2>

<p>Challenge URL: <a href="http://ctf1.codegate.org/03c1e338b6445c0f127319f5cb69920a/web1.php" target="_blank">http://ctf1.codegate.org/03c1e338b6445c0f127319f5cb69920a/web1.php</a></p>

<p>This page will ask for submitting a username for the first time. Once a username is submited ( ‘aaaa’ for example), the script will set a cookie as the following:</p>

<blockquote>
  <table>
    <tbody>
      <tr>
        <td>web1_auth = YWFhYXwx**</td>
        <td>**8f5c14cc7c1cd461f35b190af57927d1c377997e</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<table>
  <tbody>
    <tr>
      <td>The first part <strong>YWFhYXwx</strong> is the base64 encoded string of *‘aaaa</td>
      <td>1′* (username</td>
      <td>role). The second part <strong>8f5c14cc7c1cd461f35b190af57927d1c377997e</strong> is the <em>sha1(unknown_secretkey + username + role)</em>.</td>
    </tr>
  </tbody>
</table>

<p>In the next visit, the web1.php script will check for the cookie and return the following message</p>

<blockquote>
  <p>“Welcome back, aaaa! You are not the administrator.”</p>
</blockquote>

<p>We can guest that 1 is the role value for normal user and 0 for administrator.</p>

<h2 id="solution">Solution</h2>

<table>
  <tbody>
    <tr>
      <td>If we try to modify to first part of the web1_auth cookie to something like base64_encode(‘aaaa</td>
      <td>0′), the script will return an error message saying that the data has been tampered due to the wrong signature.</td>
    </tr>
  </tbody>
</table>

<p>As we know that popular hash functions including sha1 are vulnerable to length extension (or padding) attacks. This can be used to break naive authentication schemes based on hash functions.</p>

<table>
  <tbody>
    <tr>
      <td>I will not write the detail on how to do sha1 length extension attack, you can read papers in the References section below for more information. Basically, with padding attack, we can append arbitrary data to the cookie and generate a valid signature for it without knowing the secret key. In this challenge, we want to have ‘</td>
      <td>0′ (administrator role) at the end of the first part of the cookie.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>$ python sha-padding.py<br />
usage: sha-padding.py <keylen> &lt;original\_message&gt; &lt;original\_signature&gt; &lt;text\_to\_append&gt;</keylen></p>

  <p>$ python sha-padding.py 25 ‘aaaa|1′ 8f5c14cc7c1cd461f35b190af57927d1c377997e ‘|0′<br />
new msg: ‘aaaa|1x80x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00<br />
x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00xf8|0′<br />
base64: YWFhYXwxgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4fDA=<br />
new sig: 70f8bf57aa6d7faaa70ef17e763ef2578cb8d839</p>
</blockquote>

<p>And here is what we got with the web1_auth cookie using <strong>YWFhYXwxgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4fDA=</strong> and signature <strong>70f8bf57aa6d7faaa70ef17e763ef2578cb8d839</strong></p>

<blockquote>
  <p>Welcome back, aaaa! Congratulations! You did it! Here is your flag: CryptoNinjaCertified!!!!!</p>
</blockquote>

<h2 id="source-codes">Source Codes</h2>

<ul>
  <li><a href="http://force.vnsecurity.net/download/rd/shaext.py">http://force.vnsecurity.net/download/rd/shaext.py</a></li>
  <li><a href="http://force.vnsecurity.net/download/rd/sha-padding.py">http://force.vnsecurity.net/download/rd/sha-padding.py</a></li>
  <li><a href="http://force.vnsecurity.net/download/rd/sha.py">http://force.vnsecurity.net/download/rd/sha.py</a> (this one  taken from pypy lib)</li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Cryptographic_hash_function">http://en.wikipedia.org/wiki/Cryptographic_hash_function</a></li>
  <li><a href="http://netifera.com/research/flickr_api_signature_forgery.pdf">Flickr’s API Signature Forgery Vulnerability</a></li>
  <li>G. Tsudik, “Message authentication with one-way hash functions,” Proceedings of Info-com 92.</li>
</ul>

<p>Keywords: sha1, padding, length extension attack, codegate 2010</p>


  ]]></description>
</item>

</channel>
</rss>